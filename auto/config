#!/bin/bash

OPTIONS=( --mode debian
    --distribution buster )

if [[ " ${@} " =~ " build_rpi " ]]; then
  args=( ${@/build_rpi} )
  OPTIONS+=(
    --architectures armhf 
    --binary-images hdd 
    --binary-filesystem ext4 
    --hdd-size 2048 
    --hdd-partition-start 256MB 
    --bootstrap-qemu-arch armhf 
    --bootstrap-qemu-static /usr/bin/qemu-arm-static 
    --bootappend-live "boot=live config hostname=pi username=pi"
    --chroot-filesystem none 
    --firmware-binary false 
    --firmware-chroot false 
    --linux-flavours rpi 
    --mirror-bootstrap "http://raspbian.raspberrypi.org/raspbian/" 
    --mirror-binary "http://raspbian.raspberrypi.org/raspbian/" 
    --linux-packages none 
    --debootstrap-options "--keyring./raspbian_apt.gpg--include=ca-certificates"
    --archive-areas "main contrib non-free rpi"
    --system normal 
    --updates false 
    --security false)
  cp -a rpi_files/archives/* config/archives
  cp -a rpi_files/package-lists/* config/package-lists
else
    args=${@}
    OPTIONS+=(
    --architectures amd64
    --debootstrap-options --include=ca-certificates
    --binary-images iso
    --debian-installer live
    --debian-installer-gui false
    --archive-areas "main contrib non-free"
    --security true )
fi

# check for qemu-static

echo lb config noauto \
    "${OPTIONS[@]}" \
    "${args}"
